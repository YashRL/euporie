############
Key Bindings
############

*************
Editing Modes
*************

The key-bindings used when editing a cell are determined by the :option:`edit_mode` configuration variable. This can be set to ``micro``, ``emacs`` or ``vim`` to use key-bindings in the style of the respective text editor.

.. note:: The ``vim`` and ``emacs`` key-bindings are defined by the :py:mod:`prompt_toolkit` package and are largely untested, so your results may vary!


*************
Running Cells
*************

Cells can be run using :kbd:`Ctrl+Enter`, or :kbd:`Shift+Enter` to run and selct the next cell, as is the case in `JupyterLab <https://jupyter.org/>`_.

However, most terminals do not distinguish between :kbd:`Enter`, :kbd:`Ctrl+Enter` & :kbd:`Shift+Enter` by default, meaning that you have to use alternative key-bindings in euporie to run cells.

Fortunately it is possible to configure many terminals such that these key-bindings can be used, as outlined below.

.. note::
   There are two commonly used formats of escape sequecnes which can be used to distinguish these key-bindings: **FK-27** and **CSI-u**. The instuctions below implement the CSI-u style, but euporie will recognise either.

WezTerm
=======

Update your :file:`$HOME/.config/wezterm/wezterm.lua` file to include the following:

.. code-block:: lua

    local wezterm = require 'wezterm';

    return {
      -- ...

      keys = {
        {key="Enter", mods="CTRL", action=wezterm.action{SendString="\x1b[13;5u"}},
        {key="Enter", mods="SHIFT", action=wezterm.action{SendString="\x1b[13;2u"}},
      },
    }

Kitty
=====

Add the following to your :file:`$HOME/.config/kitty/kitty.conf` file:

.. code-block::

   map ctrl+enter send_text normal,application \x1b[13;5u
   map shift+enter send_text normal,application \x1b[13;2u


Foot
====

Foot supports XTerm's `K27 format <https://invisible-island.net/xterm/modified-keys.html>`_, so does not require any additional configuration.

XTerm
=====

You can add the following lines to your :file:`$HOME/.Xresources` file, which enables **CSI-u** escape sequences.

.. code-block::

   *vt100.modifyOtherKeys: 1
   *vt100.formatOtherKeys: 1


Windows Terminal
================

You can add the key-bindings to your :file:`settings.json` file:

.. code-block:: javascript

   {
     // ...

     "keybindings":
     [
       { "command": { "action": "sendInput", "input": "\u001b[13;5u" }, "keys": "ctrl+enter" },
       { "command": { "action": "sendInput", "input": "\u001b[13;2u" }, "keys": "shift+enter" }
     ]
   }


Alacritty
=========

You can define the key-binding in your :file:`$HOME/.config/alacritty/alacritty.yml` file as follows:

.. code-block:: yaml

    key_bindings:
      - { key: Return, mods: Control, chars: "\x1b[13;5u" }
      - { key: Return, mods: Shift,   chars: "\x1b[13;2u" }

Konsole
=======

In the menu, navigate to :menuselection:`Settings --> Edit Current Profile`, then select :menuselection:`Keyboard --> Edit`.

Change the existing entry for `Return+Shift` to `Return+Shift+Ctrl` (or whatever you prefer), then add the following entries:

+-----------------+-----------+
| Key combination | Output    |
+=================+===========+
| Return+Ctrl     | E\[13;5u  |
+-----------------+-----------+
| Return+Shift    | \E\[13;2u |
+-----------------+-----------+

******************************
Default Key bindings Reference
******************************

The following lists outline the default key-bindings used in euporie:

.. _keybinding-definitions-start:

App
===

+----------------------+----------------------------------------------------------------------------------+
| Keys                 | Command                                                                          |
+======================+==================================================================================+
| :kbd:`Ctrl+N`        | Create a new file.                                                               |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+O`        | Open a file.                                                                     |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+W`        | Close the current file.                                                          |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Q`        | Quit euporie.                                                                    |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Pagedown` | Switch to the next tab.                                                          |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Pageup`   | Switch to the previous tab.                                                      |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Tab`           | Focus the next control.                                                          |
|                      |                                                                                  |
| :kbd:`Ctrl+I`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+Tab`     | Focus the previous control.                                                      |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Space`    | Shows the command palette.                                                       |
|                      |                                                                                  |
| :kbd:`Ctrl+@`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+G`        | Find the next search match.                                                      |
+----------------------+----------------------------------------------------------------------------------+

Config
======

+----------------------+----------------------------------------------------------------------------------+
| Keys                 | Command                                                                          |
+======================+==================================================================================+
| :kbd:`L`             | Toggle the visibility of line numbers.                                           |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`W`             | Toggle whether cells should extend across the full width of the screen.          |
+----------------------+----------------------------------------------------------------------------------+

Notebook
========

+----------------------+----------------------------------------------------------------------------------+
| Keys                 | Command                                                                          |
+======================+==================================================================================+
| :kbd:`Ctrl+S`        | Save the current notebook.                                                       |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Enter`         | Enter cell edit mode.                                                            |
|                      |                                                                                  |
| :kbd:`Ctrl+M`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Escape`        | Exit cell edit mode.                                                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Enter`    | Run or render the current cells.                                                 |
|                      |                                                                                  |
| :kbd:`Ctrl+E`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+Enter`   | Run or render the current cells and select the next cell.                        |
|                      |                                                                                  |
| :kbd:`Ctrl+R`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+Ctrl+M`    | Run or render the current cells and insert a new cell below.                     |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`A`             | Add a new cell above the current.                                                |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`B`             | Add a new cell below the current.                                                |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`D, D`          | Delete the current cells.                                                        |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`X`             | Cut the current cells.                                                           |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`C`             | Copy the current cells.                                                          |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`V`             | Paste the previously copied cells.                                               |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+M`       | Merge the selected cells.                                                        |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`I, I`          | Interrupt the notebook's kernel.                                                 |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`0, 0`          | Restart the notebook's kernel.                                                   |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`[`             | Scroll the page up a line.                                                       |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`]`             | Scroll the page down a line.                                                     |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`{`             | Scroll the page up 5 lines.                                                      |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`}`             | Scroll the page down 5 lines.                                                    |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Home`          | Select the first cell in the notebook.                                           |
|                      |                                                                                  |
| :kbd:`Ctrl+Up`       |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Pageup`        | Go up 5 cells.                                                                   |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Up`            | Go up one cell.                                                                  |
|                      |                                                                                  |
| :kbd:`K`             |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Down`          | Select the next cell.                                                            |
|                      |                                                                                  |
| :kbd:`J`             |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Pagedown`      | Go down 5 cells.                                                                 |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`End`           | Select the last cell in the notebook.                                            |
|                      |                                                                                  |
| :kbd:`Ctrl+Down`     |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+A`        | Select all cells in the notebook.                                                |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+Home`    | Extend the cell selection to the top of the notebook.                            |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+Up`      | Extend the cell selection up a cell.                                             |
|                      |                                                                                  |
| :kbd:`Shift+K`       |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+Down`    | Extend the cell selection down a cell.                                           |
|                      |                                                                                  |
| :kbd:`Shift+J`       |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+End`     | Extend the cell selection to the bottom of the notebook.                         |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+Up`        | Move selected cells up.                                                          |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+Down`      | Move selected cells down.                                                        |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`M`             | Change selected cells to markdown cells.                                         |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Y`             | Change selected cells to code cells.                                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`R`             | Change selected cells to raw cells.                                              |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+F`       | Automatically reformat all code cells in the notebook.                           |
+----------------------+----------------------------------------------------------------------------------+

Cell
====

+----------------------+----------------------------------------------------------------------------------+
| Keys                 | Command                                                                          |
+======================+==================================================================================+
| :kbd:`E`             | Edit cell in $EDITOR.                                                            |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+\\`       | Split the current cell at the cursor position.                                   |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Up`            | Move the cursor up to the previous cell.                                         |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Down`          | Move the cursor down to the next cell.                                           |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Left`          | Scroll the cell output to the left.                                              |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Right`         | Scroll the cell output to the right.                                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+C`         | Copy the cell's output to the clipboard.                                         |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`F`             | Format the selected code cells.                                                  |
+----------------------+----------------------------------------------------------------------------------+

Pager
=====

+----------------------+----------------------------------------------------------------------------------+
| Keys                 | Command                                                                          |
+======================+==================================================================================+
| :kbd:`Escape`        | Close the pager.                                                                 |
|                      |                                                                                  |
| :kbd:`Q`             |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+

Suggestion
==========

+----------------------+----------------------------------------------------------------------------------+
| Keys                 | Command                                                                          |
+======================+==================================================================================+
| :kbd:`Right`         | Accept suggestion.                                                               |
|                      |                                                                                  |
| :kbd:`Ctrl+F`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+F`         | Fill partial suggestion.                                                         |
+----------------------+----------------------------------------------------------------------------------+

Micro edit mode
===============

+----------------------+----------------------------------------------------------------------------------+
| Keys                 | Command                                                                          |
+======================+==================================================================================+
| :kbd:`Insert`        | Toggle overwrite when using micro editing mode.                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Backspace`     | Delete the character behind the cursor.                                          |
|                      |                                                                                  |
| :kbd:`Ctrl+H`        |                                                                                  |
|                      |                                                                                  |
| :kbd:`Backspace`     |                                                                                  |
|                      |                                                                                  |
| :kbd:`Ctrl+H`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Left`     | Move back to the start of the current or previous word.                          |
|                      |                                                                                  |
| :kbd:`Alt+B`         |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Right`    | Move forward to the end of the next word.                                        |
|                      |                                                                                  |
| :kbd:`Alt+F`         |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Up`       | Move to the start of the buffer.                                                 |
|                      |                                                                                  |
| :kbd:`Ctrl+Home`     |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Down`     | Move to the end of the buffer.                                                   |
|                      |                                                                                  |
| :kbd:`Ctrl+End`      |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Pagedown`      | Scroll page down.                                                                |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Pageup`        | Scroll page up.                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Left`          | Move back a character, or up a line.                                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Right`         | Move forward a character, or down a line.                                        |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Home`          | Move the cursor to the start of the line.                                        |
|                      |                                                                                  |
| :kbd:`Alt+Left`      |                                                                                  |
|                      |                                                                                  |
| :kbd:`Alt+A`         |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`End`           | Move the cursor to the end of the line.                                          |
|                      |                                                                                  |
| :kbd:`Alt+Right`     |                                                                                  |
|                      |                                                                                  |
| :kbd:`Alt+E`         |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+{`         | Move the cursor to the start of the current paragraph.                           |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+}`         | Move the cursor to the end of the current paragraph.                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+/`        | Comments or uncomments the current or selected lines.                            |
|                      |                                                                                  |
| :kbd:`Ctrl+_`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`"`             | Wraps the current selection with: ""                                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`'`             | Wraps the current selection with: ''                                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`(`             | Wraps the current selection with: ()                                             |
|                      |                                                                                  |
| :kbd:`)`             |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`{`             | Wraps the current selection with: {}                                             |
|                      |                                                                                  |
| :kbd:`}`             |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`[`             | Wraps the current selection with: []                                             |
|                      |                                                                                  |
| :kbd:`]`             |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`\\``           | Wraps the current selection with: \`\`                                           |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`*`             | Wraps the current selection with: **                                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`_`             | Wraps the current selection with: __                                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+D`        | Duplicate the current line.                                                      |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+D`        | Duplicate the current line.                                                      |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+V`        | Paste the clipboard contents, replacing any current selection.                   |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+C`        | Adds the current selection to the clipboard.                                     |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+X`        | Removes the current selection and adds it to the clipboard.                      |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+K`        | Removes the current line adds it to the clipboard.                               |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+Up`        | Move the current or selected lines up by one line.                               |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Alt+Down`      | Move the current or selected lines down by one line.                             |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Enter`         | Accept an input.                                                                 |
|                      |                                                                                  |
| :kbd:`Ctrl+M`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Enter`         | Insert a new line, replacing any selection and indenting if appropriate.         |
|                      |                                                                                  |
| :kbd:`Ctrl+M`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Tab`           | Inndent the current or selected lines.                                           |
|                      |                                                                                  |
| :kbd:`Ctrl+I`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+Tab`     | Unindent the current or selected lines.                                          |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Backspace`     | Unindent the current or selected lines.                                          |
|                      |                                                                                  |
| :kbd:`Ctrl+H`        |                                                                                  |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`F4`            | Toggle the case of the current word or selection.                                |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Z`        | Undo the last edit.                                                              |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+Y`        | Redo the last edit.                                                              |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+A`        | Select all text.                                                                 |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Shift+Tab`     | Displays contextual help.                                                        |
+----------------------+----------------------------------------------------------------------------------+
| :kbd:`Ctrl+G`        | Go to matching bracket if the cursor is on a paired bracket.                     |
+----------------------+----------------------------------------------------------------------------------+
.. _keybinding-definitions-end:
